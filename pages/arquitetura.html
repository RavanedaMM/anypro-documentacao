<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arquitetura - ANYPRO</title>
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ—ï¸ Arquitetura do Sistema</h1>
            <div class="subtitle">Clean Architecture, DDD e CQRS</div>
        </div>
        
        <div class="breadcrumb">
            <a href="../index.html">ğŸ  Home</a>
            <span>â€º</span>
            <span>Arquitetura</span>
        </div>
        
        <div class="nav">
            <ul class="nav-links">
                <li><a href="visao-geral.html">ğŸ¯ VisÃ£o Geral</a></li>
                <li><a href="casos-uso.html">ğŸ“‹ Requisitos</a></li>
                <li><a href="arquitetura.html">ğŸ—ï¸ Arquitetura</a></li>
                <li><a href="banco-dados.html">ğŸ—„ï¸ Banco de Dados</a></li>
                <li><a href="autorizacoes.html">ğŸ” SeguranÃ§a</a></li>
                <li><a href="modulos.html">ğŸ“¦ MÃ³dulos</a></li>
                <li><a href="apis.html">ğŸ”Œ APIs</a></li>
                <li><a href="ux-acessibilidade.html">â™¿ UX</a></li>
                <li><a href="design-system.html">ğŸ¨ Design</a></li>
                <li><a href="operacoes.html">âš™ï¸ OperaÃ§Ãµes</a></li>
                <li><a href="testes.html">ğŸ§ª Testes</a></li>
                <li><a href="sistema-sis.html">ğŸ”§ Bootstrap</a></li>
                <li><a href="roadmap.html">ğŸ—“ï¸ Roadmap</a></li>
                <li><a href="contribuir.html">ğŸ¤ Contribuir</a></li>
                <li><a href="referencias.html">ğŸ“š ReferÃªncias</a></li>
                <li><a href="glossario.html">ğŸ“– GlossÃ¡rio</a></li>
            </ul>
        </div>
        
        <div class="content">
            <h2>ğŸ“˜ IntroduÃ§Ã£o</h2>
            <h3>ğŸ¯ VisÃ£o Geral da Arquitetura</h3>
            <div class="info-box">
                <p>O ANYPRO foi desenvolvido seguindo os princÃ­pios da <strong>Clean Architecture</strong> (Arquitetura Limpa) proposta por Robert C. Martin (Uncle Bob), combinada com <strong>Domain-Driven Design (DDD)</strong> e o padrÃ£o <strong>CQRS (Command Query Responsibility Segregation)</strong>.</p>
                
                <p>Esta abordagem garante:</p>
                <ul>
                    <li>âœ… <strong>IndependÃªncia de Frameworks:</strong> A lÃ³gica de negÃ³cio nÃ£o depende de bibliotecas externas</li>
                    <li>âœ… <strong>Testabilidade:</strong> Regras de negÃ³cio podem ser testadas sem UI, banco de dados ou frameworks</li>
                    <li>âœ… <strong>IndependÃªncia de UI:</strong> A interface pode ser trocada sem alterar as regras de negÃ³cio</li>
                    <li>âœ… <strong>IndependÃªncia de Banco de Dados:</strong> Possibilidade de trocar o banco de dados sem impacto no domÃ­nio</li>
                    <li>âœ… <strong>Manutenibilidade:</strong> CÃ³digo organizado em camadas com responsabilidades bem definidas</li>
                </ul>
            </div>
            
            <h2>ğŸ› ï¸ Como Fazer</h2>
            <h3>ğŸ“ Estrutura de Pastas Recomendada</h3>
            <div class="code-block">src/
â”œâ”€â”€ Anypro.Domain/           # Entidades, Value Objects, Interfaces
â”‚   â”œâ”€â”€ Entities/
â”‚   â”œâ”€â”€ ValueObjects/
â”‚   â”œâ”€â”€ Interfaces/
â”‚   â””â”€â”€ Services/
â”œâ”€â”€ Anypro.Application/      # Casos de uso, Commands, Queries
â”‚   â”œâ”€â”€ Commands/
â”‚   â”œâ”€â”€ Queries/
â”‚   â”œâ”€â”€ DTOs/
â”‚   â””â”€â”€ Validators/
â”œâ”€â”€ Anypro.Infrastructure/   # RepositÃ³rios, EF Core, ServiÃ§os externos
â”‚   â”œâ”€â”€ Persistence/
â”‚   â”œâ”€â”€ Repositories/
â”‚   â””â”€â”€ Services/
â””â”€â”€ Anypro.API/              # Controllers, Middlewares, ConfiguraÃ§Ãµes
    â”œâ”€â”€ Controllers/
    â”œâ”€â”€ Middlewares/
    â””â”€â”€ Extensions/</div>

            <h3>ğŸ“ Passo a Passo: Criar uma Nova Feature</h3>
            <div class="info-box">
                <ol>
                    <li><strong>Domain:</strong> Crie a Entidade em <code>Domain/Entities/</code></li>
                    <li><strong>Application:</strong> Crie Command/Query em <code>Application/Commands/</code></li>
                    <li><strong>Validator:</strong> Adicione validaÃ§Ãµes com FluentValidation</li>
                    <li><strong>Handler:</strong> Implemente o handler com MediatR</li>
                    <li><strong>Repository:</strong> Crie interface no Domain e implementaÃ§Ã£o na Infrastructure</li>
                    <li><strong>Controller:</strong> Exponha via API em <code>API/Controllers/</code></li>
                </ol>
            </div>

            <h3>ğŸ’» Exemplo: Command com MediatR</h3>
            <div class="code-block">// Application/Commands/CreateUsuarioCommand.cs
public record CreateUsuarioCommand(string Nome, string Email) : IRequest&lt;Guid&gt;;

public class CreateUsuarioCommandHandler : IRequestHandler&lt;CreateUsuarioCommand, Guid&gt;
{
    private readonly IUsuarioRepository _repository;
    
    public CreateUsuarioCommandHandler(IUsuarioRepository repository)
    {
        _repository = repository;
    }
    
    public async Task&lt;Guid&gt; Handle(CreateUsuarioCommand request, CancellationToken ct)
    {
        var usuario = new Usuario(request.Nome, request.Email);
        await _repository.AddAsync(usuario, ct);
        return usuario.Id;
    }
}</div>
            <a class="back-to-top" href="#top">â†‘ Voltar ao topo</a>

            <h2>ğŸ“š ReferÃªncia</h2>
            <h3>ğŸ“ Diagrama de Clean Architecture</h3>
            <div class="diagram-container">
                <div class="layer-box layer-1">
                    <strong>Presentation Layer</strong>
                    <p>API Controllers, Middlewares, Filters</p>
                </div>
                <div class="layer-box layer-2">
                    <strong>Application Layer</strong>
                    <p>Use Cases, DTOs, Commands, Queries, Validators</p>
                </div>
                <div class="layer-box layer-3">
                    <strong>Domain Layer</strong>
                    <p>Entities, Value Objects, Domain Services, Interfaces</p>
                </div>
                <div class="layer-box layer-4">
                    <strong>Infrastructure Layer</strong>
                    <p>Repositories, EF Core, External Services, File Storage</p>
                </div>
            </div>
            
            <h3>ğŸ§± Camadas da AplicaÃ§Ã£o</h3>
            
            <h3>1. Domain Layer (NÃºcleo)</h3>
            <div class="info-box">
                <p><strong>Responsabilidade:</strong> ContÃ©m as entidades do domÃ­nio, value objects, interfaces de repositÃ³rios e regras de negÃ³cio fundamentais.</p>
                
                <p><strong>Principais Componentes:</strong></p>
                <ul>
                    <li><code>Entities/</code> - Entidades do domÃ­nio (Usuario, Produto, NotaFiscal, etc)</li>
                    <li><code>ValueObjects/</code> - Objetos de valor (Email, CPF, CNPJ, Dinheiro, etc)</li>
                    <li><code>Interfaces/</code> - Contratos de repositÃ³rios e serviÃ§os</li>
                    <li><code>Events/</code> - Eventos de domÃ­nio</li>
                    <li><code>Exceptions/</code> - ExceÃ§Ãµes de domÃ­nio customizadas</li>
                </ul>
                
                <ul class="folder-tree">
                    <li>
                        <div class="tree-item"><span class="tree-icon tree-folder">ğŸ“</span><span class="tree-name">Anypro.Domain</span></div>
                        <ul class="tree-children">
                            <li>
                                <div class="tree-item"><span class="tree-icon tree-folder">ğŸ“</span><span class="tree-name">Entities</span></div>
                                <ul class="tree-children">
                                    <li>
                                        <div class="tree-item"><span class="tree-icon tree-folder">ğŸ“</span><span class="tree-name">Base</span></div>
                                        <ul class="tree-children">
                                            <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">EntityBase.cs</span></div></li>
                                            <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">TenantEntityBase.cs</span></div></li>
                                        </ul>
                                    </li>
                                    <li>
                                        <div class="tree-item"><span class="tree-icon tree-folder">ğŸ“</span><span class="tree-name">ADM</span></div>
                                        <ul class="tree-children">
                                            <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">Usuario.cs</span></div></li>
                                            <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">Perfil.cs</span></div></li>
                                            <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">Autorizacao.cs</span></div></li>
                                            <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">Organizacao.cs</span></div></li>
                                        </ul>
                                    </li>
                                    <li>
                                        <div class="tree-item"><span class="tree-icon tree-folder">ğŸ“</span><span class="tree-name">SUP</span></div>
                                        <ul class="tree-children">
                                            <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">Produto.cs</span></div></li>
                                            <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">Fornecedor.cs</span></div></li>
                                            <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">PedidoCompra.cs</span></div></li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li>
                                <div class="tree-item"><span class="tree-icon tree-folder">ğŸ“</span><span class="tree-name">ValueObjects</span></div>
                                <ul class="tree-children">
                                    <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">Email.cs</span></div></li>
                                    <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">CPF.cs</span></div></li>
                                    <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">CNPJ.cs</span></div></li>
                                    <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">Dinheiro.cs</span></div></li>
                                </ul>
                            </li>
                            <li>
                                <div class="tree-item"><span class="tree-icon tree-folder">ğŸ“</span><span class="tree-name">Interfaces</span></div>
                                <ul class="tree-children">
                                    <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">IRepository.cs</span></div></li>
                                    <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">IUnitOfWork.cs</span></div></li>
                                    <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">ITenantProvider.cs</span></div></li>
                                </ul>
                            </li>
                            <li>
                                <div class="tree-item"><span class="tree-icon tree-folder">ğŸ“</span><span class="tree-name">Events</span></div>
                                <ul class="tree-children">
                                    <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">DomainEvent.cs</span></div></li>
                                    <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">IDomainEventHandler.cs</span></div></li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
            
            <h3>2. Application Layer</h3>
            <div class="info-box">
                <p><strong>Responsabilidade:</strong> Implementa os casos de uso da aplicaÃ§Ã£o, orquestra o fluxo de dados e coordena a execuÃ§Ã£o das regras de negÃ³cio.</p>
                
                <p><strong>Principais Componentes:</strong></p>
                <ul>
                    <li><code>Commands/</code> - Comandos CQRS (Criar, Atualizar, Excluir)</li>
                    <li><code>Queries/</code> - Consultas CQRS (Listar, Buscar, Obter)</li>
                    <li><code>DTOs/</code> - Data Transfer Objects</li>
                    <li><code>Validators/</code> - ValidaÃ§Ãµes com FluentValidation</li>
                    <li><code>Mappers/</code> - Mapeamentos com AutoMapper</li>
                </ul>
                
                <ul class="folder-tree">
                    <li>
                        <div class="tree-item"><span class="tree-icon tree-folder">ğŸ“</span><span class="tree-name">Anypro.Application</span></div>
                        <ul class="tree-children">
                            <li>
                                <div class="tree-item"><span class="tree-icon tree-folder">ğŸ“</span><span class="tree-name">Commands</span></div>
                                <ul class="tree-children">
                                    <li>
                                        <div class="tree-item"><span class="tree-icon tree-folder">ğŸ“</span><span class="tree-name">Usuarios</span></div>
                                        <ul class="tree-children">
                                            <li>
                                                <div class="tree-item"><span class="tree-icon tree-folder">ğŸ“</span><span class="tree-name">CriarUsuario</span></div>
                                                <ul class="tree-children">
                                                    <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">CriarUsuarioCommand.cs</span></div></li>
                                                    <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">CriarUsuarioCommandHandler.cs</span></div></li>
                                                    <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">CriarUsuarioCommandValidator.cs</span></div></li>
                                                </ul>
                                            </li>
                                            <li>
                                                <div class="tree-item"><span class="tree-icon tree-folder">ğŸ“</span><span class="tree-name">AtualizarUsuario</span></div>
                                                <ul class="tree-children">
                                                    <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">AtualizarUsuarioCommand.cs</span></div></li>
                                                    <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">AtualizarUsuarioCommandHandler.cs</span></div></li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li>
                                <div class="tree-item"><span class="tree-icon tree-folder">ğŸ“</span><span class="tree-name">Queries</span></div>
                                <ul class="tree-children">
                                    <li>
                                        <div class="tree-item"><span class="tree-icon tree-folder">ğŸ“</span><span class="tree-name">Usuarios</span></div>
                                        <ul class="tree-children">
                                            <li>
                                                <div class="tree-item"><span class="tree-icon tree-folder">ğŸ“</span><span class="tree-name">ListarUsuarios</span></div>
                                                <ul class="tree-children">
                                                    <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">ListarUsuariosQuery.cs</span></div></li>
                                                    <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">ListarUsuariosQueryHandler.cs</span></div></li>
                                                </ul>
                                            </li>
                                            <li>
                                                <div class="tree-item"><span class="tree-icon tree-folder">ğŸ“</span><span class="tree-name">ObterUsuarioPorId</span></div>
                                                <ul class="tree-children">
                                                    <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">ObterUsuarioPorIdQuery.cs</span></div></li>
                                                    <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">ObterUsuarioPorIdQueryHandler.cs</span></div></li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li>
                                <div class="tree-item"><span class="tree-icon tree-folder">ğŸ“</span><span class="tree-name">DTOs</span></div>
                                <ul class="tree-children">
                                    <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">UsuarioDTO.cs</span></div></li>
                                    <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">PerfilDTO.cs</span></div></li>
                                    <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">ProdutoDTO.cs</span></div></li>
                                </ul>
                            </li>
                            <li>
                                <div class="tree-item"><span class="tree-icon tree-folder">ğŸ“</span><span class="tree-name">Mappers</span></div>
                                <ul class="tree-children">
                                    <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">MappingProfile.cs</span></div></li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
            
            <h3>3. Infrastructure Layer</h3>
            <div class="info-box">
                <p><strong>Responsabilidade:</strong> Implementa as interfaces definidas no Domain Layer, contÃ©m o acesso a dados, serviÃ§os externos e configuraÃ§Ãµes de infraestrutura.</p>
                
                <p><strong>Principais Componentes:</strong></p>
                <ul>
                    <li><code>Persistence/</code> - Entity Framework Core, DbContext, Migrations</li>
                    <li><code>Repositories/</code> - ImplementaÃ§Ã£o dos repositÃ³rios</li>
                    <li><code>Services/</code> - ServiÃ§os de infraestrutura (Email, Storage, etc)</li>
                    <li><code>Cache/</code> - Redis cache provider</li>
                </ul>
                
                <ul class="folder-tree">
                    <li>
                        <div class="tree-item"><span class="tree-icon tree-folder">ğŸ“</span><span class="tree-name">Anypro.Infrastructure</span></div>
                        <ul class="tree-children">
                            <li>
                                <div class="tree-item"><span class="tree-icon tree-folder">ğŸ“</span><span class="tree-name">Persistence</span></div>
                                <ul class="tree-children">
                                    <li>
                                        <div class="tree-item"><span class="tree-icon tree-folder">ğŸ“</span><span class="tree-name">Configurations</span></div>
                                        <ul class="tree-children">
                                            <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">UsuarioConfiguration.cs</span></div></li>
                                            <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">ProdutoConfiguration.cs</span></div></li>
                                        </ul>
                                    </li>
                                    <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">Migrations</span></div></li>
                                    <li>
                                        <div class="tree-item"><span class="tree-icon tree-folder">ğŸ“</span><span class="tree-name">Seeders</span></div>
                                        <ul class="tree-children">
                                            <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">PaisSeeder.cs</span></div></li>
                                            <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">AutorizacaoSeeder.cs</span></div></li>
                                        </ul>
                                    </li>
                                    <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">AppDbContext.cs</span></div></li>
                                </ul>
                            </li>
                            <li>
                                <div class="tree-item"><span class="tree-icon tree-folder">ğŸ“</span><span class="tree-name">Repositories</span></div>
                                <ul class="tree-children">
                                    <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">UsuarioRepository.cs</span></div></li>
                                    <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">ProdutoRepository.cs</span></div></li>
                                </ul>
                            </li>
                            <li>
                                <div class="tree-item"><span class="tree-icon tree-folder">ğŸ“</span><span class="tree-name">Services</span></div>
                                <ul class="tree-children">
                                    <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">EmailService.cs</span></div></li>
                                    <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">FileStorageService.cs</span></div></li>
                                </ul>
                            </li>
                            <li>
                                <div class="tree-item"><span class="tree-icon tree-folder">ğŸ“</span><span class="tree-name">Cache</span></div>
                                <ul class="tree-children">
                                    <li><div class="tree-item"><span class="tree-icon tree-file">ğŸ“„</span><span class="tree-name">RedisCacheService.cs</span></div></li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
            
            <h3>4. Presentation Layer (API)</h3>
            <div class="info-box">
                <p><strong>Responsabilidade:</strong> ExpÃµe a aplicaÃ§Ã£o via RESTful API, contÃ©m os controllers, middlewares, filters e configuraÃ§Ãµes do ASP.NET Core.</p>
                
                <p><strong>Principais Componentes:</strong></p>
                <ul>
                    <li><code>Controllers/</code> - Endpoints da API REST</li>
                    <li><code>Middlewares/</code> - Middleware de autenticaÃ§Ã£o, logging, exception handling</li>
                    <li><code>Filters/</code> - Action filters, validation filters</li>
                </ul>
                
                <div class="code-block">Anypro.API/
â”œâ”€â”€ Controllers/
â”‚   â”œâ”€â”€ V1/
â”‚   â”‚   â”œâ”€â”€ UsuariosController.cs
â”‚   â”‚   â”œâ”€â”€ ProdutosController.cs
â”‚   â”‚   â””â”€â”€ AuthController.cs
â”œâ”€â”€ Middlewares/
â”‚   â”œâ”€â”€ TenantResolverMiddleware.cs
â”‚   â”œâ”€â”€ ExceptionHandlingMiddleware.cs
â”‚   â””â”€â”€ RequestLoggingMiddleware.cs
â”œâ”€â”€ Filters/
â”‚   â”œâ”€â”€ ValidateModelFilter.cs
â”‚   â””â”€â”€ AuthorizationFilter.cs
â””â”€â”€ Program.cs</div>
            </div>
            
            <h3>ğŸ”„ CQRS Pattern</h3>
            <div class="warning-box">
                <h4>Command Query Responsibility Segregation</h4>
                <p>SeparaÃ§Ã£o entre operaÃ§Ãµes de <strong>escrita</strong> (Commands) e <strong>leitura</strong> (Queries).</p>
                
                <p><strong>Commands (Escrita):</strong></p>
                <ul>
                    <li>Modificam o estado da aplicaÃ§Ã£o</li>
                    <li>ValidaÃ§Ãµes complexas com FluentValidation</li>
                    <li>Utilizam EF Core para persistÃªncia</li>
                    <li>Retornam apenas sucesso/erro (nÃ£o retornam dados)</li>
                </ul>
                
                <p><strong>Queries (Leitura):</strong></p>
                <ul>
                    <li>Apenas consultam dados (sem alteraÃ§Ãµes)</li>
                    <li>Podem usar Dapper para performance</li>
                    <li>Podem usar cache (Redis)</li>
                    <li>Retornam DTOs otimizados</li>
                </ul>
            </div>
            
            <h3>ğŸ“¦ PadrÃµes de Projeto Utilizados</h3>
            <table>
                <thead>
                    <tr>
                        <th>PadrÃ£o</th>
                        <th>DescriÃ§Ã£o</th>
                        <th>Onde Ã© usado</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Repository Pattern</strong></td>
                        <td>AbstraÃ§Ã£o do acesso a dados</td>
                        <td>Camada Infrastructure</td>
                    </tr>
                    <tr>
                        <td><strong>Unit of Work</strong></td>
                        <td>Gerenciamento de transaÃ§Ãµes</td>
                        <td>EF Core DbContext</td>
                    </tr>
                    <tr>
                        <td><strong>Dependency Injection</strong></td>
                        <td>InjeÃ§Ã£o de dependÃªncias nativa do .NET</td>
                        <td>Todas as camadas</td>
                    </tr>
                    <tr>
                        <td><strong>Factory Pattern</strong></td>
                        <td>CriaÃ§Ã£o de entidades complexas</td>
                        <td>Domain Layer</td>
                    </tr>
                    <tr>
                        <td><strong>Specification Pattern</strong></td>
                        <td>Encapsulamento de regras de negÃ³cio em consultas</td>
                        <td>Repository + LINQ</td>
                    </tr>
                    <tr>
                        <td><strong>Strategy Pattern</strong></td>
                        <td>CÃ¡lculos de impostos, regras de negÃ³cio variÃ¡veis</td>
                        <td>Domain Services</td>
                    </tr>
                    <tr>
                        <td><strong>Observer Pattern</strong></td>
                        <td>Domain Events (MediatR)</td>
                        <td>Application Layer</td>
                    </tr>
                </tbody>
            </table>
            
            <h3>ğŸ” Multi-Tenancy Strategy</h3>
            <div class="info-box">
                <p><strong>Abordagem HÃ­brida: Database Per Tenant com Schema Isolation</strong></p>
                
                <p><strong>ImplementaÃ§Ã£o:</strong></p>
                <ul>
                    <li>âœ… Banco PostgreSQL compartilhado</li>
                    <li>âœ… Schema <code>global</code> para tabelas TBG (Pais, Moeda, Autorizacao, etc)</li>
                    <li>âœ… Schema <code>tenant_{tenantId}</code> para tabelas TBP (Usuario, Produto, NotaFiscal, etc)</li>
                    <li>âœ… Middleware <code>TenantResolverMiddleware</code> extrai TenantId do JWT</li>
                    <li>âœ… Global Query Filter no EF Core adiciona <code>WHERE TenantId = @currentTenantId</code> automaticamente</li>
                </ul>
                
                <div class="code-block">// TenantResolverMiddleware.cs
public class TenantResolverMiddleware
{
    public async Task InvokeAsync(HttpContext context, ITenantProvider tenantProvider)
    {
        var token = context.Request.Headers["Authorization"].FirstOrDefault()?.Split(" ").Last();
        if (token != null)
        {
            var tenantId = ExtractTenantIdFromToken(token);
            tenantProvider.SetTenantId(tenantId);
        }
        
        await _next(context);
    }
}

// AppDbContext.cs
protected override void OnModelCreating(ModelBuilder modelBuilder)
{
    // Global Query Filter para entidades multi-tenant
    modelBuilder.Entity<Usuario>().HasQueryFilter(u => u.TenantId == _tenantProvider.GetTenantId());
    modelBuilder.Entity<Produto>().HasQueryFilter(p => p.TenantId == _tenantProvider.GetTenantId());
    </div>
    <h2>ğŸ§ª Exemplos</h2>
    <div class="info-box">
        <p>Inclua exemplos concretos: snippets de casos de uso, estrutura mÃ­nima de projetos, e variaÃ§Ãµes de implementaÃ§Ã£o.</p>
    </div>
                        </div>
            
                </div>
        
                <div class="footer">
                        <p><strong>ANYPRO - Sistema ERP Modular Multi-Tenant</strong></p>
                        <p><a href="../home.html">Voltar ao Menu Principal</a></p>
                </div>
        </div>
        <script>
        (function() {
      const trees = document.querySelectorAll('.folder-tree');
      trees.forEach(tree => {
        tree.querySelectorAll('li').forEach(li => {
          const children = li.querySelector(':scope > .tree-children');
          const item = li.querySelector(':scope > .tree-item');
          if (children && item) {
            item.classList.add('expandable');
            // Insert caret if missing
            if (!item.querySelector('.caret')) {
              const caret = document.createElement('span');
              caret.className = 'caret';
              caret.textContent = 'â–¸';
              item.insertBefore(caret, item.firstChild);
            }
            // Default expanded
            item.setAttribute('data-expanded', 'true');
            children.hidden = false;
          }
        });
        tree.addEventListener('click', function(e) {
          const item = e.target.closest('.tree-item.expandable');
          if (!item) return;
          const li = item.parentElement;
          const children = li.querySelector(':scope > .tree-children');
          if (!children) return;
          const expanded = item.getAttribute('data-expanded') === 'true';
          item.setAttribute('data-expanded', expanded ? 'false' : 'true');
          children.hidden = expanded;
        });
      });
    })();
    </script>
        <script src="../js/toc.js" defer></script>
        <script src="../js/section-nav.js" defer></script>
        <script src="../js/nav-active.js" defer></script>
</body>
</html>
