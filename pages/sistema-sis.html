<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema SIS - ANYPRO</title>
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚öôÔ∏è Sistema SIS (Seeders e Inicializa√ß√£o)</h1>
            <div class="subtitle">Carga Inicial de Dados Globais</div>
        </div>
        
        <div class="breadcrumb">
            <a href="../index.html">üè† Home</a>
            <span>‚Ä∫</span>
            <span>Sistema (SIS)</span>
        </div>
        
        <div class="nav">
            <ul class="nav-links">
                <li><a href="visao-geral.html">üéØ Vis√£o Geral</a></li>
                <li><a href="casos-uso.html">üìã Requisitos</a></li>
                <li><a href="arquitetura.html">üèóÔ∏è Arquitetura</a></li>
                <li><a href="banco-dados.html">üóÑÔ∏è Banco de Dados</a></li>
                <li><a href="autorizacoes.html">üîê Seguran√ßa</a></li>
                <li><a href="modulos.html">üì¶ M√≥dulos</a></li>
                <li><a href="apis.html">üîå APIs</a></li>
                <li><a href="ux-acessibilidade.html">‚ôø UX</a></li>
                <li><a href="design-system.html">üé® Design</a></li>
                <li><a href="operacoes.html">‚öôÔ∏è Opera√ß√µes</a></li>
                <li><a href="testes.html">üß™ Testes</a></li>
                <li><a href="sistema-sis.html">üîß Bootstrap</a></li>
                <li><a href="roadmap.html">üóìÔ∏è Roadmap</a></li>
                <li><a href="contribuir.html">ü§ù Contribuir</a></li>
                <li><a href="referencias.html">üìö Refer√™ncias</a></li>
                <li><a href="glossario.html">üìñ Gloss√°rio</a></li>
            </ul>
        </div>
        
        <div class="content">
            <h2>üìò Introdu√ß√£o</h2>
            <h3>üå± O que √© o Sistema SIS?</h3>
            <div class="info-box">
                <p>O <strong>Sistema SIS (Seeders de Inicializa√ß√£o do Sistema)</strong> √© respons√°vel pela carga inicial de dados globais (tabelas TBG) necess√°rios para o funcionamento do ANYPRO.</p>
                
                <p>Esses dados s√£o compartilhados entre todas as organiza√ß√µes (tenants) e incluem:</p>
                <ul>
                    <li>üåç Dados de localiza√ß√£o (Pa√≠ses, Estados, Cidades)</li>
                    <li>üí± Configura√ß√µes monet√°rias (Moedas)</li>
                    <li>üó£Ô∏è Idiomas suportados</li>
                    <li>üìè Unidades de medida</li>
                    <li>üìÑ Tipos de documentos</li>
                    <li>üîê Autoriza√ß√µes do sistema</li>
                    <li>üíº Regimes tribut√°rios e naturezas de opera√ß√£o</li>
                </ul>
            </div>
            
            <h2>üõ†Ô∏è Como Fazer</h2>
            
            <h3>1. Executar Seeders via CLI</h3>
            <pre><code># Executar todos os seeders em ordem
dotnet run --project src/Anypro.Infrastructure -- seed --all

# Executar seeder espec√≠fico
dotnet run --project src/Anypro.Infrastructure -- seed --name TbgPaisSeeder

# Verificar status dos seeders
dotnet run --project src/Anypro.Infrastructure -- seed --status

# Output esperado:
# ‚úÖ TbgPaisSeeder          - 195 registros
# ‚úÖ TbgEstadoSeeder        - 27 registros  
# ‚úÖ TbgCidadeSeeder        - 5570 registros
# ‚úÖ TbgMoedaSeeder         - 15 registros
# ‚è≥ TbgIdiomaSeeder        - Pendente</code></pre>
            
            <h3>2. Criar um Novo Seeder</h3>
            <pre><code>// src/Anypro.Infrastructure/Persistence/Seeders/TbgExemploSeeder.cs
public class TbgExemploSeeder : ISeeder
{
    public int Order => 50; // Ordem de execu√ß√£o
    public string Name => "TbgExemploSeeder";
    
    private readonly ApplicationDbContext _context;
    
    public TbgExemploSeeder(ApplicationDbContext context)
    {
        _context = context;
    }
    
    public async Task SeedAsync(CancellationToken ct = default)
    {
        if (await _context.TbgExemplos.AnyAsync(ct))
            return; // J√° executado
        
        var dados = new List&lt;TbgExemplo&gt;
        {
            new("EX001", "Exemplo 1", true),
            new("EX002", "Exemplo 2", true),
            new("EX003", "Exemplo 3", false)
        };
        
        await _context.TbgExemplos.AddRangeAsync(dados, ct);
        await _context.SaveChangesAsync(ct);
        
        Console.WriteLine($"‚úÖ {Name}: {dados.Count} registros inseridos");
    }
}

// Registrar no DI
services.AddScoped&lt;ISeeder, TbgExemploSeeder&gt;();</code></pre>
            
            <h3>3. Seeder com Dados de Arquivo JSON</h3>
            <pre><code>// Para tabelas grandes como Cidades (5570+ registros)
public class TbgCidadeSeeder : ISeeder
{
    public int Order => 3;
    
    public async Task SeedAsync(CancellationToken ct = default)
    {
        if (await _context.TbgCidades.AnyAsync(ct))
            return;
        
        // Carregar dados de arquivo JSON
        var jsonPath = Path.Combine(
            AppContext.BaseDirectory, 
            "Seeders", "Data", "cidades.json"
        );
        
        var json = await File.ReadAllTextAsync(jsonPath, ct);
        var cidades = JsonSerializer.Deserialize&lt;List&lt;CidadeDto&gt;&gt;(json);
        
        // Inserir em lotes para performance
        const int batchSize = 500;
        for (int i = 0; i &lt; cidades.Count; i += batchSize)
        {
            var batch = cidades.Skip(i).Take(batchSize)
                .Select(c => new TbgCidade(c.Codigo, c.Nome, c.EstadoId, c.CodigoIbge))
                .ToList();
            
            await _context.TbgCidades.AddRangeAsync(batch, ct);
            await _context.SaveChangesAsync(ct);
        }
    }
}</code></pre>
            
            <h3>4. Executar via Migration (Produ√ß√£o)</h3>
            <pre><code>// Migrations/20240115_SeedInitialData.cs
public partial class SeedInitialData : Migration
{
    protected override void Up(MigrationBuilder migrationBuilder)
    {
        // Pa√≠ses
        migrationBuilder.InsertData(
            table: "tbg_paises",
            columns: new[] { "codigo", "nome", "sigla", "ativo" },
            values: new object[,]
            {
                { "BR", "Brasil", "BRA", true },
                { "US", "Estados Unidos", "USA", true },
                { "PT", "Portugal", "PRT", true }
            }
        );
        
        // Moedas
        migrationBuilder.InsertData(
            table: "tbg_moedas",
            columns: new[] { "codigo", "nome", "simbolo", "casas_decimais" },
            values: new object[,]
            {
                { "BRL", "Real Brasileiro", "R$", 2 },
                { "USD", "D√≥lar Americano", "$", 2 },
                { "EUR", "Euro", "‚Ç¨", 2 }
            }
        );
    }
}</code></pre>
            
            <h3>5. Checklist de Bootstrap</h3>
            <table>
                <thead>
                    <tr>
                        <th>Categoria</th>
                        <th>Tabela</th>
                        <th>Registros</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Localiza√ß√£o</td>
                        <td>tbg_paises</td>
                        <td>~195</td>
                        <td>‚¨ú</td>
                    </tr>
                    <tr>
                        <td>Localiza√ß√£o</td>
                        <td>tbg_estados</td>
                        <td>~27</td>
                        <td>‚¨ú</td>
                    </tr>
                    <tr>
                        <td>Localiza√ß√£o</td>
                        <td>tbg_cidades</td>
                        <td>~5570</td>
                        <td>‚¨ú</td>
                    </tr>
                    <tr>
                        <td>Monet√°rio</td>
                        <td>tbg_moedas</td>
                        <td>~15</td>
                        <td>‚¨ú</td>
                    </tr>
                    <tr>
                        <td>Sistema</td>
                        <td>tbg_autorizacoes</td>
                        <td>~50</td>
                        <td>‚¨ú</td>
                    </tr>
                    <tr>
                        <td>Fiscal</td>
                        <td>tbg_regimes_tributarios</td>
                        <td>~4</td>
                        <td>‚¨ú</td>
                    </tr>
                </tbody>
            </table>

            <h2>üìö Refer√™ncia</h2>
            <h3>üìã Ordem de Execu√ß√£o dos Seeders</h3>
            <div class="warning-box">
                <p><strong>‚ö†Ô∏è Importante:</strong> Os seeders devem ser executados na ordem abaixo para respeitar as depend√™ncias entre tabelas (foreign keys).</p>
            </div>
            
            <table>
                <thead>
                    <tr>
                        <th>Ordem</th>
                        <th>Seeder</th>
                        <th>Tabela</th>
                        <th>Tipo</th>
                        <th>Descri√ß√£o</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1</td>
                        <td><code>PaisSeeder</code></td>
                        <td>Pais</td>
                        <td><span class="badge badge-tbg">TBG</span></td>
                        <td>Pa√≠ses do mundo (ISO 3166) - 195 pa√≠ses</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td><code>EstadoSeeder</code></td>
                        <td>Estado</td>
                        <td><span class="badge badge-tbg">TBG</span></td>
                        <td>Estados/Prov√≠ncias (27 estados do Brasil)</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td><code>CidadeSeeder</code></td>
                        <td>Cidade</td>
                        <td><span class="badge badge-tbg">TBG</span></td>
                        <td>Munic√≠pios brasileiros (5570+ cidades)</td>
                    </tr>
                    <tr>
                        <td>4</td>
                        <td><code>MoedaSeeder</code></td>
                        <td>Moeda</td>
                        <td><span class="badge badge-tbg">TBG</span></td>
                        <td>Moedas mundiais (ISO 4217) - 180+ moedas</td>
                    </tr>
                    <tr>
                        <td>5</td>
                        <td><code>IdiomaSeeder</code></td>
                        <td>Idioma</td>
                        <td><span class="badge badge-tbg">TBG</span></td>
                        <td>Idiomas suportados (ISO 639) - PT-BR, EN, ES</td>
                    </tr>
                    <tr>
                        <td>6</td>
                        <td><code>UnidadeMedidaSeeder</code></td>
                        <td>UnidadeMedida</td>
                        <td><span class="badge badge-tbg">TBG</span></td>
                        <td>Unidades (kg, L, m, UN, CX, etc)</td>
                    </tr>
                    <tr>
                        <td>7</td>
                        <td><code>TipoDocumentoSeeder</code></td>
                        <td>TipoDocumento</td>
                        <td><span class="badge badge-tbg">TBG</span></td>
                        <td>Tipos de documentos (CPF, CNPJ, RG, Passaporte)</td>
                    </tr>
                    <tr>
                        <td>8</td>
                        <td><code>RegimeTributarioSeeder</code></td>
                        <td>RegimeTributario</td>
                        <td><span class="badge badge-tbg">TBG</span></td>
                        <td>Regimes tribut√°rios (Simples, Lucro Real, Presumido)</td>
                    </tr>
                    <tr>
                        <td>9</td>
                        <td><code>NaturezaOperacaoSeeder</code></td>
                        <td>NaturezaOperacao</td>
                        <td><span class="badge badge-tbg">TBG</span></td>
                        <td>CFOP - C√≥digo Fiscal de Opera√ß√µes</td>
                    </tr>
                    <tr>
                        <td>10</td>
                        <td><code>AutorizacaoSeeder</code></td>
                        <td>Autorizacao</td>
                        <td><span class="badge badge-tbg">TBG</span></td>
                        <td>Autoriza√ß√µes do sistema (120+ autoriza√ß√µes)</td>
                    </tr>
                </tbody>
            </table>
            
            <h3>üíª Executando os Seeders</h3>
            
            <h4>Via EF Core Migration</h4>
            <div class="code-block">// Adicione no arquivo de migration ap√≥s criar as tabelas
protected override void Up(MigrationBuilder migrationBuilder)
{
    // Cria√ß√£o das tabelas...
    
    // Execu√ß√£o dos seeders
    SeedersRunner.ExecutarTodos(migrationBuilder);
}

// SeedersRunner.cs
public static class SeedersRunner
{
    public static void ExecutarTodos(MigrationBuilder migrationBuilder)
    {
        new PaisSeeder().Seed(migrationBuilder);
        new EstadoSeeder().Seed(migrationBuilder);
        new CidadeSeeder().Seed(migrationBuilder);
        new MoedaSeeder().Seed(migrationBuilder);
        new IdiomaSeeder().Seed(migrationBuilder);
        new UnidadeMedidaSeeder().Seed(migrationBuilder);
        new TipoDocumentoSeeder().Seed(migrationBuilder);
        new RegimeTributarioSeeder().Seed(migrationBuilder);
        new NaturezaOperacaoSeeder().Seed(migrationBuilder);
        new AutorizacaoSeeder().Seed(migrationBuilder);
    }
}</div>
            
            <h4>Via Command Line</h4>
            <div class="code-block">dotnet ef database update
# Ou
dotnet run --project Anypro.API -- seed</div>
            
            <h2>üß™ Exemplos</h2>
            <h3>üì¶ Exemplo de Seeder: PaisSeeder</h3>
            <div class="code-block">public class PaisSeeder : ISeeder
{
    public void Seed(MigrationBuilder migrationBuilder)
    {
        migrationBuilder.InsertData(
            table: "Pais",
            columns: new[] { "Id", "Nome", "Codigo", "CodigoISO2", "CodigoISO3", "DDI", "Ativo", "CriadoEm" },
            values: new object[,]
            {
                { Guid.NewGuid(), "Brasil", "076", "BR", "BRA", "+55", true, DateTime.UtcNow },
                { Guid.NewGuid(), "Estados Unidos", "840", "US", "USA", "+1", true, DateTime.UtcNow },
                { Guid.NewGuid(), "Argentina", "032", "AR", "ARG", "+54", true, DateTime.UtcNow },
                { Guid.NewGuid(), "Chile", "152", "CL", "CHL", "+56", true, DateTime.UtcNow },
                { Guid.NewGuid(), "Uruguai", "858", "UY", "URY", "+598", true, DateTime.UtcNow },
                { Guid.NewGuid(), "Paraguai", "600", "PY", "PRY", "+595", true, DateTime.UtcNow },
                { Guid.NewGuid(), "Portugal", "620", "PT", "PRT", "+351", true, DateTime.UtcNow },
                { Guid.NewGuid(), "Espanha", "724", "ES", "ESP", "+34", true, DateTime.UtcNow },
                // ... mais pa√≠ses
            });
    }
}</div>
            
            <h3>üîê Exemplo: AutorizacaoSeeder (M√≥dulo ADM)</h3>
            <div class="code-block">public class AutorizacaoSeeder : ISeeder
{
    public void Seed(MigrationBuilder migrationBuilder)
    {
        var autorizacoes = new List<Autorizacao>
        {
            // M√≥dulo ADM - Usu√°rios
            new Autorizacao("ADM.USU.LISTAR", "Listar usu√°rios", "ADM"),
            new Autorizacao("ADM.USU.VISUALIZAR", "Visualizar detalhes do usu√°rio", "ADM"),
            new Autorizacao("ADM.USU.CRIAR", "Criar novo usu√°rio", "ADM"),
            new Autorizacao("ADM.USU.EDITAR", "Editar usu√°rio", "ADM"),
            new Autorizacao("ADM.USU.EXCLUIR", "Excluir usu√°rio", "ADM"),
            new Autorizacao("ADM.USU.ATIVAR", "Ativar/Desativar usu√°rio", "ADM"),
            new Autorizacao("ADM.USU.RESETAR_SENHA", "Resetar senha do usu√°rio", "ADM"),
            
            // M√≥dulo ADM - Perfis
            new Autorizacao("ADM.PER.LISTAR", "Listar perfis de acesso", "ADM"),
            new Autorizacao("ADM.PER.VISUALIZAR", "Visualizar detalhes do perfil", "ADM"),
            new Autorizacao("ADM.PER.CRIAR", "Criar novo perfil", "ADM"),
            new Autorizacao("ADM.PER.EDITAR", "Editar perfil", "ADM"),
            new Autorizacao("ADM.PER.EXCLUIR", "Excluir perfil", "ADM"),
            
            // M√≥dulo ADM - Organiza√ß√µes
            new Autorizacao("ADM.ORG.LISTAR", "Listar organiza√ß√µes", "ADM"),
            new Autorizacao("ADM.ORG.VISUALIZAR", "Visualizar detalhes da organiza√ß√£o", "ADM"),
            new Autorizacao("ADM.ORG.CRIAR", "Criar nova organiza√ß√£o", "ADM"),
            new Autorizacao("ADM.ORG.EDITAR", "Editar organiza√ß√£o", "ADM"),
            new Autorizacao("ADM.ORG.EXCLUIR", "Excluir organiza√ß√£o", "ADM"),
            
            // M√≥dulo SUP - Fornecedores
            new Autorizacao("SUP.FOR.LISTAR", "Listar fornecedores", "SUP"),
            new Autorizacao("SUP.FOR.VISUALIZAR", "Visualizar detalhes do fornecedor", "SUP"),
            new Autorizacao("SUP.FOR.CRIAR", "Criar novo fornecedor", "SUP"),
            new Autorizacao("SUP.FOR.EDITAR", "Editar fornecedor", "SUP"),
            new Autorizacao("SUP.FOR.EXCLUIR", "Excluir fornecedor", "SUP"),
            
            // M√≥dulo SUP - Produtos
            new Autorizacao("SUP.PRO.LISTAR", "Listar produtos", "SUP"),
            new Autorizacao("SUP.PRO.VISUALIZAR", "Visualizar detalhes do produto", "SUP"),
            new Autorizacao("SUP.PRO.CRIAR", "Criar novo produto", "SUP"),
            new Autorizacao("SUP.PRO.EDITAR", "Editar produto", "SUP"),
            new Autorizacao("SUP.PRO.EXCLUIR", "Excluir produto", "SUP"),
            
            // ... mais autoriza√ß√µes dos demais m√≥dulos
        };
        
        foreach (var auth in autorizacoes)
        {
            migrationBuilder.InsertData(
                table: "Autorizacao",
                columns: new[] { "Id", "Codigo", "Descricao", "Modulo", "Ativo", "CriadoEm" },
                values: new object[] { auth.Id, auth.Codigo, auth.Descricao, auth.Modulo, true, DateTime.UtcNow }
            );
        }
    }
}</div>
            
            <h3>üìä Estat√≠sticas de Dados Globais</h3>
            <div class="info-box">
                <table>
                    <thead>
                        <tr>
                            <th>Tabela</th>
                            <th>Quantidade de Registros</th>
                            <th>Tamanho Aproximado</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Pais</td>
                            <td>~195</td>
                            <td>15 KB</td>
                        </tr>
                        <tr>
                            <td>Estado (Brasil)</td>
                            <td>27</td>
                            <td>2 KB</td>
                        </tr>
                        <tr>
                            <td>Cidade (Brasil)</td>
                            <td>~5.570</td>
                            <td>450 KB</td>
                        </tr>
                        <tr>
                            <td>Moeda</td>
                            <td>~180</td>
                            <td>12 KB</td>
                        </tr>
                        <tr>
                            <td>Idioma</td>
                            <td>3 (PT-BR, EN, ES)</td>
                            <td>1 KB</td>
                        </tr>
                        <tr>
                            <td>UnidadeMedida</td>
                            <td>~50</td>
                            <td>4 KB</td>
                        </tr>
                        <tr>
                            <td>TipoDocumento</td>
                            <td>~10</td>
                            <td>1 KB</td>
                        </tr>
                        <tr>
                            <td>RegimeTributario</td>
                            <td>~8</td>
                            <td>1 KB</td>
                        </tr>
                        <tr>
                            <td>NaturezaOperacao (CFOP)</td>
                            <td>~500</td>
                            <td>40 KB</td>
                        </tr>
                        <tr>
                            <td>Autorizacao</td>
                            <td>~120</td>
                            <td>10 KB</td>
                        </tr>
                    </tbody>
                </table>
                
                <p><strong>Total aproximado:</strong> 536 KB de dados globais compartilhados</p>
            </div>
            
            <h2>üîÑ Atualiza√ß√£o dos Seeders</h2>
            <div class="warning-box">
                <h4>Quando atualizar os seeders?</h4>
                <ul>
                    <li>‚úÖ Novos pa√≠ses/estados/cidades adicionados</li>
                    <li>‚úÖ Altera√ß√µes em c√≥digos fiscais (CFOP)</li>
                    <li>‚úÖ Novos idiomas suportados</li>
                    <li>‚úÖ Novas autoriza√ß√µes de m√≥dulos</li>
                    <li>‚úÖ Mudan√ßas em regimes tribut√°rios</li>
                </ul>
                
                <h4>Como atualizar?</h4>
                <div class="code-block"># 1. Criar nova migration
dotnet ef migrations add AtualizacaoSeeder_YYYYMMDD

# 2. Editar migration e adicionar/alterar dados no m√©todo Up()

# 3. Aplicar migration
dotnet ef database update</div>
            </div>
            
        </div>
        
        <div class="footer">
            <p><strong>ANYPRO - Sistema ERP Modular Multi-Tenant</strong></p>
            <p><a href="../home.html">Voltar ao Menu Principal</a></p>
        </div>
    </div>
    <script src="../js/toc.js" defer></script>
<script src="../js/section-nav.js" defer></script>
<script src="../js/nav-active.js" defer></script>
</body>
</html>
